<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¥åº·æ•¸æ“šç´€éŒ„</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
body {
  font-family: "Helvetica Neue", Arial, sans-serif;
  font-size: 18px;         /* å…¨åŸŸå­—é«”å¤§å° */
  line-height: 1.6;
  padding: 15px;
}

h1 {
  font-size: 32px;
  font-weight: bold;
  margin: 20px 0;
  text-align: center;
}

h2 {
  font-size: 24px;
  font-weight: bold;
  margin: 15px 0 10px;
  border-left: 5px solid #007aff;
  padding-left: 8px;
}

.pane {
  border: 2px solid #ccc;
  border-radius: 8px;
  padding: 15px;
  margin: 15px 0;
  background: #fafafa;
}

input {
  font-size: 18px;
  padding: 6px 10px;
  margin: 4px 0;
  border: 1px solid #ccc;
  border-radius: 5px;
  width: 150px;
}

button {
  font-size: 18px;
  font-weight: bold;
  padding: 6px 14px;
  margin-left: 6px;
  background: #007aff;
  color: #fff;
  border: none;
  border-radius: 5px;
}

button.ghost {
  background: #f0f0f0;
  color: #333;
}

#list, #debug {
  font-size: 16px;
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 10px;
  margin-top: 10px;
  background: #fff;
  min-height: 50px;
}

#toast {
  font-size: 16px;
  font-weight: bold;
  background: #333;
  color: #fff;
  padding: 10px;
  border-radius: 6px;
  margin-top: 10px;
  display: none;
  text-align: center;
}

  </style>
</head>
<body>
  <h1>å¥åº·æ•¸æ“šç´€éŒ„</h1>

  <div class="pane" id="bp">
    <h2>è¡€å£“</h2>
    <input id="bp-sys" type="number" placeholder="æ”¶ç¸®å£“"> /
    <input id="bp-dia" type="number" placeholder="èˆ’å¼µå£“">
    <button id="btn-bp">åŠ å…¥</button>
  </div>

  <div class="pane" id="glu">
    <h2>è¡€ç³–</h2>
    <input id="glu-fpg" type="number" placeholder="ç©ºè…¹è¡€ç³–">
    <button id="btn-fpg">åŠ å…¥</button><br>
    <input id="glu-ppg" type="number" placeholder="é£¯å¾Œè¡€ç³–">
    <button id="btn-ppg">åŠ å…¥</button>
  </div>

  <div class="pane" id="others">
    <h2>å…¶ä»–</h2>
    <input id="hr" type="number" placeholder="å¿ƒè·³ bpm">
    <button id="btn-hr">åŠ å…¥</button><br>
    <input id="weight" type="number" placeholder="é«”é‡ kg">
    <button id="btn-weight">åŠ å…¥</button><br>
    <input id="fat" type="number" placeholder="é«”è„‚ %">
    <button id="btn-fat">åŠ å…¥</button><br>
    <input id="water" type="number" placeholder="å–æ°´ ml">
    <button id="btn-water">åŠ å…¥</button><br>
    <input id="exer" type="number" placeholder="é‹å‹• åˆ†é˜">
    <button id="btn-exer">åŠ å…¥</button><br>
    <input id="sleep" type="number" placeholder="ç¡çœ åˆ†æ•¸ 1~10">
    <button id="btn-sleep">åŠ å…¥</button>
  </div>

  <h2>æ¸…å–®</h2>
  <div id="list"></div>
  <button id="btnClear">æ¸…ç©ºæ¸…å–®</button>
  <button id="btnSubmit">é€å‡º</button>

  <h2>Debug</h2>
  <div id="debug"></div>

<script>
const CONFIG = {
  bpSys: ['90-109','110-119','120-129','130-139','140-159','â‰¥160'],
  bpDia: ['60-69','70-79','80-89','90-99','â‰¥100'],
  gluFPG: ['70-80','81-90','91-100','101-110','111-125','â‰¥126'],
  gluPPG: ['90-110','111-139','140-159','160-179','â‰¥180'],
  quickOthers: [
    { metric:'å¿ƒè·³', unit:'bpm', choices:['60-70','71-80','81-90','91-100','101-110','â‰¥111'] },
    { metric:'é«”é‡', unit:'kg', choices:['45-55','56-60','61-65','66-70','71-75','76-80','81-85','86-90','â‰¥91'] },
    { metric:'é«”è„‚', unit:'%', choices:['18-20','21-23','24-26','27-29','30-32','33-35','â‰¥36'] },
    { metric:'å–æ°´', unit:'ml', choices:['200','500','1000','1500','2000','2500','â‰¥3000'] },
    { metric:'é‹å‹•', unit:'min', choices:['10','20','30','45','60','90','â‰¥91'] },
    { metric:'ç¡çœ ', unit:'/10', choices:['1','2','3','4','5','6','7','8','9','10'] }
  ]
};

const queue = [];
function $(id){ return document.getElementById(id); }
function renderList(){ $('list').innerText = queue.map(x=>JSON.stringify(x)).join('\n'); }
function dbg(msg){ $('debug').innerText += msg + '\n'; }
function toast(msg){ alert(msg); }

// åŠ å…¥è³‡æ–™
function initInputs(){
  $('btn-bp').onclick=()=>{ queue.push({metric:'è¡€å£“', value:$('bp-sys').value+'/'+$('bp-dia').value, unit:'mmHg'}); renderList(); };
  $('btn-fpg').onclick=()=>{ queue.push({metric:'ç©ºè…¹è¡€ç³–', value:$('glu-fpg').value, unit:'mg/dL'}); renderList(); };
  $('btn-ppg').onclick=()=>{ queue.push({metric:'é£¯å¾Œè¡€ç³–', value:$('glu-ppg').value, unit:'mg/dL'}); renderList(); };
  $('btn-hr').onclick =()=>{ queue.push({metric:'å¿ƒè·³', value:$('hr').value, unit:'bpm'}); renderList(); };
  $('btn-weight').onclick=()=>{ queue.push({metric:'é«”é‡', value:$('weight').value, unit:'kg'}); renderList(); };
  $('btn-fat').onclick=()=>{ queue.push({metric:'é«”è„‚', value:$('fat').value, unit:'%'}); renderList(); };
  $('btn-water').onclick=()=>{ queue.push({metric:'å–æ°´', value:$('water').value, unit:'ml'}); renderList(); };
  $('btn-exer').onclick=()=>{ queue.push({metric:'é‹å‹•', value:$('exer').value, unit:'min'}); renderList(); };
  $('btn-sleep').onclick=()=>{ queue.push({metric:'ç¡çœ ', value:$('sleep').value, unit:'/10'}); renderList(); };
}

// é€å‡º
async function initSubmit(){
  $('btnClear').onclick=()=>{ queue.length=0; renderList(); };

  $('btnSubmit').onclick=async()=>{
    if(!queue.length) return toast('æ¸…å–®æ˜¯ç©ºçš„');

    let userId=null, displayName='';
    try {
      const profile = await liff.getProfile();
      userId = profile.userId;
      displayName = profile.displayName;
    } catch(e){
      console.warn('getProfile error', e);
    }

    const payload={source:'LIFF', userId, displayName, items:queue};
    dbg('ğŸ“¦ Payload:\n'+JSON.stringify(payload,null,2));

    try{
      const res = await fetch("https://script.google.com/macros/s/AKfycbz2gRMRHwSbecpF5L95pdBdHqahNmx9wmCAItRW6GlTI-xRcXfzMRTGSqNAvgwjHoV9dA/exec",{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const txt = await res.text();
      dbg('ä¼ºæœå™¨å›æ‡‰: '+txt);
      queue.length=0; renderList();
      toast('âœ… å·²é€å‡ºï¼');
    }catch(err){
      console.error('é€å‡ºéŒ¯èª¤', err);
      dbg('Error: '+err);
      toast('âŒ é€å‡ºå¤±æ•—');
    }
  };
}

async function main(){
  console.log("ğŸš€ main() å•Ÿå‹•");   
  await liff.init({ liffId:"2008049339-GDpDJd3j", withLoginOnExternalBrowser:true });
  if(!liff.isLoggedIn()){
    liff.login({ redirectUri: location.href.split('#')[0] });
  }
  boot();
}

function boot(){
  initInputs();
  initSubmit();
}

main();
</script>
</body>
</html>


